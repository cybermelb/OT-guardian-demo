<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OT Guardian Security Posture Management</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React, ReactDOM, and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Print/PDF Optimization for Reports -->
    <style>
        @media print {
            /* Hide navigation and controls for clean printing */
            .print-hide { display: none !important; }
            /* Ensure content takes full width */
            .print-full { max-width: none !important; margin: 0 !important; padding: 0 !important; }
            body, .bg-gray-100 { background-color: white !important; }
            /* Force table cells to break for smaller print pages */
            .table-responsive td, .table-responsive th { white-space: normal !important; }
        }
        /* Custom progress ring style */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getFirestore, doc, setDoc, updateDoc, collection, query, onSnapshot, serverTimestamp, setLogLevel } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { X, CheckCircle, Cpu, HardHat, BarChart2, Shield, User, LogOut, Plus, Edit, Trash2, Save, Zap, FileText, Download, AlertTriangle, Settings, BookOpen, Layers, GitBranch, Key, RefreshCw } from 'lucide-react';

        // --- CONFIGURATION CHECK & CONSTANTS ---
        let firebaseConfig = {};
        let appId = 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        try {
            const fConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const aId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            
            if (fConfig && fConfig.apiKey) {
                firebaseConfig = fConfig;
                appId = aId;
            } else {
                console.error("Firebase config is missing or invalid.");
            }
        } catch (e) {
            console.error("Failed to parse Firebase configuration:", e);
        }

        let app, db, auth;
        const PUBLIC_DATA_PATH = `/artifacts/${appId}/public/data`;
        const CONTROL_STATUSES = ['Not Assessed', 'Implemented', 'Partially Implemented', 'Not Implemented', 'Not Applicable'];
        const PURDUE_ZONES = ['Level 0: Process', 'Level 1: Basic Control', 'Level 2: Supervisory', 'Level 3: Operations', 'Level 4: Enterprise'];

        // Mock Users for Admin Dashboard demonstration
        const MOCK_USERS = [
            { id: 'admin-temp-id', email: 'admin@otg.com', role: 'admin', uid: 'admin-UID-123456' },
            { id: 'manager-temp-id', email: 'manager@otg.com', role: 'manager', uid: 'manager-UID-123456' },
            { id: 'engineer-temp-id', email: 'engineer@otg.com', role: 'engineer', uid: 'engineer-UID-123456' },
        ];
        
        // --- FACTORY FUNCTIONS FOR COMPLEX DATA MODELS ---

        const createInitialIEC62443 = () => ([
            { fr: 'FR1', name: 'Identification & Authentication Control (IAC)', targetSL: 3, controls: [
                { cid: 'IAC1', requirement: 'Unique User IDs', status: 'Not Assessed', notes: '' },
                { cid: 'IAC2', requirement: 'Password Complexity', status: 'Not Assessed', notes: '' },
                { cid: 'IAC3', requirement: 'Multi-Factor Auth', status: 'Not Assessed', notes: '' },
            ]},
            { fr: 'FR2', name: 'Use Control (UC)', targetSL: 2, controls: [
                { cid: 'UC1', requirement: 'Role-Based Access', status: 'Not Assessed', notes: '' },
                { cid: 'UC2', requirement: 'Principle of Least Privilege', status: 'Not Assessed', notes: '' },
            ]},
            { fr: 'FR3', name: 'System Integrity (SI)', targetSL: 4, controls: [
                { cid: 'SI1', requirement: 'Anti-Malware', status: 'Not Assessed', notes: '' },
                { cid: 'SI2', requirement: 'Patch Management', status: 'Not Assessed', notes: '' },
            ]},
            // ... more FRs would go here ...
        ]);
        
        const createInitialFlatControls = (frameworkName) => {
            const controlsMap = {
                sans: [
                    { id: 'sans_inventory_devices', name: 'Inventory of Authorized Devices', description: 'Maintain a detailed inventory of all assets.', status: 'Not Assessed', notes: '' },
                    { id: 'sans_vulnerability', name: 'Vulnerability Management', description: 'Implement a continuous vulnerability discovery and remediation process.', status: 'Not Assessed', notes: '' },
                ],
                ciFortify: [
                    { id: 'ci_1_inventory', name: 'Inventory and Control of Hardware Assets', description: 'Actively manage all hardware devices on the network.', status: 'Not Assessed', notes: '' },
                    { id: 'ci_3_mfa', name: 'Multi-Factor Authentication', description: 'Implement MFA for all remote and privileged access.', status: 'Not Assessed', notes: '' },
                ]
            };
            return controlsMap[frameworkName] || [];
        };

        const createNewAsset = (formData, creatorId) => ({
            name: formData.name,
            type: formData.type,
            zone: formData.zone,
            impact: formData.impact,
            createdBy: creatorId,
            riskScore: 50, // Initial score
            // Complex Nested Structures
            iec62443: createInitialIEC62443(),
            sans: createInitialFlatControls('sans'),
            ciFortify: createInitialFlatControls('ciFortify'),
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp(),
        });


        // --- UTILITY COMPONENTS ---

        const LoadingState = ({ message = 'Initializing Firebase connection...' }) => (
            <div className="flex flex-col items-center justify-center p-20 bg-white rounded-xl shadow-lg mt-10">
                <div className="animate-spin rounded-full h-12 w-12 border-b-4 border-indigo-600 mb-4"></div>
                <span className="text-xl font-medium text-indigo-700">{message}</span>
            </div>
        );

        const ErrorState = ({ title, message }) => (
            <div className="flex flex-col items-center justify-center p-20 bg-red-50 rounded-xl shadow-lg border-2 border-red-300 mt-10">
                <AlertTriangle className="w-12 h-12 text-red-500 mb-4" />
                <h2 className="text-2xl font-bold text-red-800 mb-2">{title}</h2>
                <p className="text-gray-700 text-center max-w-md">{message}</p>
            </div>
        );

        const ProgressRing = ({ percentage, color = '#4F46E5', radius = 60, stroke = 10 }) => {
            const normalizedRadius = radius - stroke * 2;
            const circumference = normalizedRadius * 2 * Math.PI;
            const strokeDashoffset = circumference - (percentage / 100) * circumference;

            return (
                <svg height={radius * 2} width={radius * 2} className="mx-auto">
                    <circle
                        stroke="#E0E7FF"
                        fill="transparent"
                        strokeWidth={stroke}
                        r={normalizedRadius}
                        cx={radius}
                        cy={radius}
                    />
                    <circle
                        stroke={color}
                        fill="transparent"
                        strokeWidth={stroke}
                        strokeDasharray={circumference + ' ' + circumference}
                        style={{ strokeDashoffset }}
                        r={normalizedRadius}
                        cx={radius}
                        cy={radius}
                        className="progress-ring__circle"
                    />
                    <text x="50%" y="50%" textAnchor="middle" dy=".3em" fontSize="1.2em" fontWeight="bold" fill={color}>
                        {Math.round(percentage)}%
                    </text>
                </svg>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [firebaseError, setFirebaseError] = useState(null);
            
            // Temporary Role State for demonstration purposes
            const [userRole, setUserRole] = useState('admin'); // Default role
            
            // App Data State
            const [assets, setAssets] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [currentView, setCurrentView] = useState('riskDashboard');
            const [isModalOpen, setIsModalOpen] = useState(false);

            // --- FIREBASE INITIALIZATION AND AUTH (Vanilla JS style lifecycle) ---

            const signInUser = useCallback(async () => {
                try {
                    if (!auth) return;

                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Sign-in failed:", error);
                } finally {
                    // CRITICAL: Dismiss loading state regardless of outcome
                    setIsAuthReady(true);
                }
            }, []);
            
            useEffect(() => {
                if (Object.keys(firebaseConfig).length === 0) {
                    setFirebaseError("Firebase configuration is missing.");
                    setIsAuthReady(true);
                    return;
                }

                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    setLogLevel('debug'); // Enable detailed Firebase logging

                    const unsubscribe = onAuthStateChanged(auth, (user) => {
                        if (user) {
                            setUserId(user.uid);
                        } else {
                            setUserId(null);
                        }
                        // Setting isAuthReady here is critical for the initial load
                        // and prevents the page from hanging if auth fails or is slow.
                        setIsAuthReady(true);
                    });

                    // Kick off sign-in if no user is found/listener hasn't fired
                    if (!auth.currentUser) {
                        signInUser();
                    }

                    return () => unsubscribe();
                } catch (error) {
                    console.error("Firebase Initialization Error:", error);
                    setFirebaseError(`Initialization failed: ${error.message}`);
                    setIsAuthReady(true); // Dismiss loading on init failure
                }
            }, [signInUser]);

            // --- FIRESTORE DATA LISTENING ---

            useEffect(() => {
                if (!db || !isAuthReady || !userId) return;

                const assetUnsub = onSnapshot(query(collection(db, `${PUBLIC_DATA_PATH}/assets`)), (snapshot) => {
                    const fetchedAssets = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        // Ensure nested arrays are correctly initialized if missing
                        iec62443: doc.data().iec62443 || createInitialIEC62443(),
                        sans: doc.data().sans || createInitialFlatControls('sans'),
                        ciFortify: doc.data().ciFortify || createInitialFlatControls('ciFortify'),
                    })).filter(doc => !doc.deleted);
                    setAssets(fetchedAssets);
                }, (error) => console.error("Error fetching assets:", error));
                
                const tasksUnsub = onSnapshot(query(collection(db, `${PUBLIC_DATA_PATH}/remediationTasks`)), (snapshot) => {
                    const fetchedTasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).filter(doc => !doc.deleted);
                    setTasks(fetchedTasks);
                }, (error) => console.error("Error fetching tasks:", error));

                return () => {
                    assetUnsub();
                    tasksUnsub();
                };
            }, [isAuthReady, userId]);

            // --- DATA OPERATIONS ---

            const addAsset = async (formData) => {
                const newAsset = createNewAsset(formData, userId);
                try {
                    const assetRef = doc(collection(db, `${PUBLIC_DATA_PATH}/assets`));
                    await setDoc(assetRef, newAsset);
                    console.log("Asset added with ID: ", assetRef.id);
                } catch (e) {
                    console.error("Error adding asset: ", e);
                }
            };
            
            const updateAssetControl = async (assetId, framework, controlPath, newStatus) => {
                const assetRef = doc(db, `${PUBLIC_DATA_PATH}/assets`, assetId);
                const assetToUpdate = assets.find(a => a.id === assetId);

                if (!assetToUpdate) {
                    console.error("Asset not found for update.");
                    return;
                }

                try {
                    const updatedAsset = { ...assetToUpdate };

                    if (framework === 'iec62443') {
                        // controlPath is an array: [frIndex, controlIndex]
                        const [frIndex, controlIndex] = controlPath;
                        updatedAsset.iec62443[frIndex].controls[controlIndex].status = newStatus;
                        await updateDoc(assetRef, { iec62443: updatedAsset.iec62443, updatedAt: serverTimestamp() });
                    } else {
                        // controlPath is just the index for flat arrays
                        const controlIndex = controlPath;
                        updatedAsset[framework][controlIndex].status = newStatus;
                        await updateDoc(assetRef, { [framework]: updatedAsset[framework], updatedAt: serverTimestamp() });
                    }
                    console.log(`Control status updated for asset ${assetId} (${framework}).`);
                } catch (e) {
                    console.error("Error updating control status: ", e);
                }
            };

            const addTask = async (assetName, description, priority = 'Medium') => {
                try {
                    const taskRef = collection(db, `${PUBLIC_DATA_PATH}/remediationTasks`);
                    await setDoc(doc(taskRef), {
                        assetName,
                        description,
                        priority,
                        status: 'Open',
                        createdBy: userId,
                        createdAt: serverTimestamp(),
                    });
                    console.log("Remediation Task added.");
                } catch (e) {
                    console.error("Error adding task: ", e);
                }
            };

            const updateTaskStatus = async (taskId, newStatus) => {
                try {
                    const taskRef = doc(db, `${PUBLIC_DATA_PATH}/remediationTasks`, taskId);
                    await updateDoc(taskRef, { status: newStatus, updatedAt: serverTimestamp() });
                    console.log(`Task ${taskId} status updated to ${newStatus}.`);
                } catch (e) {
                    console.error("Error updating task status: ", e);
                }
            };
            
            const hasAccess = useCallback((requiredRoles) => requiredRoles.includes(userRole), [userRole]);

            // --- UI RENDER LOGIC ---

            if (firebaseError) {
                return <ErrorState title="Critical Error" message={firebaseError} />;
            }
            
            if (!isAuthReady) {
                return <LoadingState />;
            }

            // --- CALCULATED VALUES ---
            const totalControls = assets.reduce((sum, asset) => 
                sum + (asset.iec62443?.reduce((cSum, fr) => cSum + (fr.controls?.length || 0), 0) || 0)
            , 0);

            const implementedControls = assets.reduce((sum, asset) => 
                sum + (asset.iec62443?.reduce((cSum, fr) => 
                    cSum + (fr.controls?.filter(c => c.status === 'Implemented').length || 0), 0) || 0)
            , 0);

            const overallCompliance = totalControls > 0 ? (implementedControls / totalControls) * 100 : 0;
            const openTasks = tasks.filter(t => t.status !== 'Complete').length;

            const navItems = [
                { view: 'riskDashboard', label: 'Risk Dashboard', icon: Shield, roles: ['admin', 'manager', 'engineer'] },
                { view: 'managerDashboard', label: 'Manager Dashboard', icon: BarChart2, roles: ['admin', 'manager'] },
                { view: 'assetBuilder', label: 'Asset Builder', icon: Cpu, roles: ['admin', 'engineer'] },
                { view: 'securityControls', label: 'Controls', icon: CheckCircle, roles: ['admin', 'engineer'] },
                { view: 'remediationTasks', label: 'Remediation Tasks', icon: HardHat, roles: ['admin', 'manager', 'engineer'] },
                { view: 'reports', label: 'Reports', icon: FileText, roles: ['admin', 'manager'] },
                { view: 'userGuide', label: 'User Guide', icon: BookOpen, roles: ['admin', 'manager', 'engineer'] },
                { view: 'settings', label: 'Settings', icon: Settings, roles: ['admin'] },
                { view: 'adminDashboard', label: 'Admin', icon: User, roles: ['admin'] },
            ].filter(item => hasAccess(item.roles));

            const renderView = () => {
                switch (currentView) {
                    case 'riskDashboard':
                        return <RiskDashboard assets={assets} tasks={tasks} overallCompliance={overallCompliance} />;
                    case 'managerDashboard':
                        return <ManagerDashboard assets={assets} overallCompliance={overallCompliance} />;
                    case 'assetBuilder':
                        return <AssetBuilder assets={assets} addAsset={addAsset} openModal={setIsModalOpen} closeModal={setIsModalOpen} isModalOpen={isModalOpen} userId={userId} />;
                    case 'securityControls':
                        return <SecurityControls assets={assets} updateAssetControl={updateAssetControl} addTask={addTask} hasAccess={hasAccess(['admin', 'engineer'])} />;
                    case 'remediationTasks':
                        return <RemediationTasks tasks={tasks} updateTaskStatus={updateTaskStatus} hasAccess={hasAccess(['admin', 'engineer'])} />;
                    case 'reports':
                        return <Reports />;
                    case 'settings':
                        return <SettingsPage />;
                    case 'adminDashboard':
                        return <AdminDashboard userId={userId} appId={appId} />;
                    case 'userGuide':
                        return <UserGuide />;
                    default:
                        return <RiskDashboard assets={assets} tasks={tasks} overallCompliance={overallCompliance} />;
                }
            };
            
            // --- MAIN APPLICATION LAYOUT ---
            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="bg-indigo-800 text-white shadow-xl print-hide">
                        <div className="container mx-auto px-4 py-3 flex justify-between items-center">
                            <h1 className="text-2xl font-bold flex items-center">
                                <Shield className="w-6 h-6 mr-2" />
                                OT Guardian Security Posture Management
                            </h1>
                            <div className="flex items-center space-x-4">
                                {/* Role Selector for Demonstration */}
                                <div className="text-sm flex items-center bg-indigo-700 p-2 rounded-lg">
                                    <span className="mr-2">View as:</span>
                                    <select
                                        value={userRole}
                                        onChange={(e) => {
                                            setUserRole(e.target.value);
                                            setCurrentView('riskDashboard'); // Reset view on role change
                                        }}
                                        className="bg-indigo-600 text-white rounded-md p-1 font-semibold focus:ring-2 focus:ring-white"
                                    >
                                        <option value="admin">Admin</option>
                                        <option value="manager">Manager</option>
                                        <option value="engineer">Engineer</option>
                                    </select>
                                </div>
                                <span className="text-sm font-medium hidden sm:inline">Current User: <code className="bg-indigo-700 px-2 py-1 rounded-md text-xs break-all">{userId}</code></span>
                                <button 
                                    onClick={() => console.log("Sign Out Placeholder")}
                                    className="p-2 rounded-full bg-indigo-700 hover:bg-indigo-600 transition-colors shadow-lg" 
                                    title="Sign Out (Placeholder)"
                                >
                                    <LogOut className='w-5 h-5' />
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="flex-grow container mx-auto px-4 py-4 print-full">
                        {/* Navigation Bar */}
                        <nav className="flex space-x-1 p-3 rounded-xl bg-white shadow-lg print-hide overflow-x-auto whitespace-nowrap mb-6">
                            {navItems.map(item => (
                                <button
                                    key={item.view}
                                    onClick={() => setCurrentView(item.view)}
                                    className={`flex items-center px-3 py-2 text-sm font-semibold rounded-lg transition-all duration-150 ${
                                        currentView === item.view ? 'bg-indigo-700 text-white shadow-md' : 'text-gray-700 hover:bg-indigo-100'
                                    }`}
                                >
                                    <item.icon className="w-4 h-4 mr-2" />
                                    {item.label}
                                </button>
                            ))}
                        </nav>

                        {/* Main Content Area */}
                        <main className="p-1 sm:p-4">
                            {renderView()}
                        </main>
                    </div>
                </div>
            );
        };

        // --- SUB-COMPONENTS & VIEWS ---

        const StatCard = ({ icon: Icon, title, value, color, children }) => (
            <div className="p-5 rounded-xl shadow-lg flex flex-col justify-between transition-all duration-300 transform hover:scale-[1.01] bg-white border-l-4" style={{ borderColor: color }}>
                <div className="flex items-center space-x-4">
                    <div className="p-3 rounded-full" style={{ backgroundColor: `${color}1A` }}>
                        <Icon className="w-6 h-6" style={{ color: color }} />
                    </div>
                    <div>
                        <p className="text-sm font-medium text-gray-500">{title}</p>
                        <p className="text-3xl font-bold text-gray-900">{value}</p>
                    </div>
                </div>
                {children && <div className="mt-3 text-sm text-gray-600">{children}</div>}
            </div>
        );
        
        // 5.1 Risk Dashboard
        const RiskDashboard = ({ assets, tasks, overallCompliance }) => {
            const highRiskAssets = assets.filter(a => a.riskScore > 60).length;
            const openTasks = tasks.filter(t => t.status !== 'Complete').length;
            const targetSLAchieved = Math.floor(Math.random() * 5); // Mock metric

            return (
                <div className="space-y-8">
                    <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">OT Security Risk Dashboard</h1>
                    
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <StatCard icon={Cpu} title="Total Assets" value={assets.length} color="#3B82F6" />
                        <StatCard icon={AlertTriangle} title="High Risk Assets" value={highRiskAssets} color="#DC2626" />
                        <StatCard icon={HardHat} title="Open Remediation Tasks" value={openTasks} color="#F59E0B" />
                        <StatCard icon={Target} title="Target SL Achieved" value={targetSLAchieved} color="#10B981" />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Compliance Status Ring */}
                        <div className="bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
                            <h2 className="text-xl font-semibold text-indigo-700 mb-4">Overall IEC 62443 Compliance</h2>
                            <ProgressRing percentage={overallCompliance} />
                            <p className="mt-4 text-center text-sm text-gray-600">
                                {implementedControls} / {totalControls} Controls Implemented
                            </p>
                        </div>

                        {/* Risk Heatmap: Purdue Zones */}
                        <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                            <h2 className="text-xl font-semibold text-indigo-700 mb-4">Risk Heatmap: Assets by Purdue Zone</h2>
                            <p className="text-sm text-gray-500 mb-4">
                                This visualization maps asset risk against the physical/logical network segmentation of the Purdue Model.
                            </p>
                            
                            

                            <div className="grid grid-cols-2 sm:grid-cols-5 gap-4 mt-6">
                                {PURDUE_ZONES.map((zone, index) => {
                                    const count = assets.filter(a => a.zone === zone).length;
                                    const riskLevel = count > 3 ? 'bg-red-500' : count > 0 ? 'bg-yellow-500' : 'bg-green-500';
                                    return (
                                        <div key={index} className={`${riskLevel} text-white p-3 rounded-lg text-center font-bold shadow-md`}>
                                            <div className="text-xs font-light opacity-80">{zone.split(': ')[0]}</div>
                                            <div className="text-2xl">{count}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 5.2 Manager Dashboard
        const ManagerDashboard = ({ assets, overallCompliance }) => {
            const riskScore = (10 - (overallCompliance / 10)).toFixed(1); // Inverse relationship to score
            const frCompliance = useMemo(() => {
                const frMap = {};
                assets.forEach(asset => {
                    asset.iec62443?.forEach(fr => {
                        if (!frMap[fr.fr]) { frMap[fr.fr] = { total: 0, implemented: 0, name: fr.name }; }
                        frMap[fr.fr].total += fr.controls.length;
                        frMap[fr.fr].implemented += fr.controls.filter(c => c.status === 'Implemented').length;
                    });
                });
                return Object.entries(frMap).map(([fr, data]) => ({
                    fr, 
                    name: data.name,
                    percentage: data.total > 0 ? (data.implemented / data.total) * 100 : 0,
                }));
            }, [assets]);

            return (
                <div className="space-y-8">
                    <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Executive Posture Overview</h1>
                    
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <StatCard icon={BarChart2} title="Mock Risk Score" value={`${riskScore} / 10`} color="#9333EA" />
                        <StatCard icon={Shield} title="Overall Compliance" value={`${overallCompliance.toFixed(1)}%`} color="#10B981" />
                        <StatCard icon={Target} title="Target SL (Mocked)" value="SL 3 / SL 4" color="#F97316" />
                    </div>

                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-semibold text-indigo-700 mb-4">IEC 62443 Foundational Requirement (FR) Coverage</h2>
                        <p className="text-sm text-gray-500 mb-4">
                            Progress for key Foundational Requirements based on asset-level control implementation.
                        </p>
                        
                        

                        <div className="space-y-4">
                            {frCompliance.map(({ fr, name, percentage }) => (
                                <div key={fr}>
                                    <div className="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                        <span>{fr}: {name}</span>
                                        <span className="font-bold">{percentage.toFixed(0)}%</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2.5">
                                        <div 
                                            className="h-2.5 rounded-full" 
                                            style={{ width: `${percentage}%`, backgroundColor: percentage > 75 ? '#10B981' : percentage > 40 ? '#F59E0B' : '#DC2626' }}
                                        ></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 5.3 Asset Builder
        const AssetBuilder = ({ assets, addAsset, openModal, closeModal, isModalOpen, userId }) => {
            const [filter, setFilter] = useState('');
            const [formData, setFormData] = useState({ name: '', type: 'PLC', zone: PURDUE_ZONES[0], impact: 'High' });

            const filteredAssets = assets.filter(a => 
                a.name.toLowerCase().includes(filter.toLowerCase()) || 
                a.zone.toLowerCase().includes(filter.toLowerCase())
            );

            const handleFormChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                await addAsset(formData);
                setFormData({ name: '', type: 'PLC', zone: PURDUE_ZONES[0], impact: 'High' });
                closeModal(false);
            };

            const AssetTable = ({ assetList }) => (
                <div className="bg-white rounded-xl shadow-lg overflow-x-auto table-responsive">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purdue Zone</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impact</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Score</th>
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {assetList.map(asset => (
                                <tr key={asset.id} className="hover:bg-indigo-50 transition-colors">
                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{asset.name || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{asset.type || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{asset.zone || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{asset.impact || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-bold text-indigo-600">{asset.riskScore || 'N/A'}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );

            const AssetModal = () => (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4 print-hide">
                    <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-full overflow-y-auto">
                        <div className="flex justify-between items-center p-4 border-b">
                            <h3 className="text-xl font-bold text-gray-800">Add New OT Asset</h3>
                            <button onClick={() => closeModal(false)} className="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100"><X className="w-6 h-6" /></button>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            <div><label className="block text-sm font-medium text-gray-700">Name</label><input type="text" name="name" value={formData.name} onChange={handleFormChange} required className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm" /></div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Type</label>
                                <select name="type" value={formData.type} onChange={handleFormChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm">
                                    {['PLC', 'HMI', 'Server', 'Historian', 'Workstation'].map(t => <option key={t} value={t}>{t}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Zone</label>
                                <select name="zone" value={formData.zone} onChange={handleFormChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm">
                                    {PURDUE_ZONES.map(z => <option key={z} value={z}>{z}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Impact</label>
                                <select name="impact" value={formData.impact} onChange={handleFormChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm">
                                    {['High', 'Medium', 'Low'].map(i => <option key={i} value={i}>{i}</option>)}
                                </select>
                            </div>
                            <div className="flex justify-end pt-4"><button type="submit" className="flex items-center bg-indigo-600 text-white px-4 py-2 rounded-xl font-semibold hover:bg-indigo-700"><Save className="w-5 h-5 mr-2" /> Add Asset</button></div>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="space-y-6">
                    <div className="flex flex-col sm:flex-row justify-between items-center border-b pb-4">
                        <h1 className="text-3xl font-extrabold text-gray-800 mb-3 sm:mb-0">Asset Inventory ({assets.length})</h1>
                        <div className="flex space-x-3 w-full sm:w-auto">
                            <input type="text" placeholder="Filter by Name or Zone..." value={filter} onChange={(e) => setFilter(e.target.value)} className="px-3 py-2 border border-gray-300 rounded-xl shadow-sm w-full sm:w-64" />
                            <button 
                                onClick={() => openModal(true)}
                                className="flex items-center bg-indigo-600 text-white px-4 py-2 rounded-xl font-semibold shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                <Plus className="w-5 h-5 mr-2" /> Add Asset
                            </button>
                        </div>
                    </div>
                    <AssetTable assetList={filteredAssets} />
                    {isModalOpen && <AssetModal />}
                </div>
            );
        };

        // 5.4 Security Controls
        const SecurityControls = ({ assets, updateAssetControl, addTask, hasAccess }) => {
            const [selectedAssetId, setSelectedAssetId] = useState(assets[0]?.id || '');
            const [selectedFramework, setSelectedFramework] = useState('iec62443');
            const asset = assets.find(a => a.id === selectedAssetId);
            
            useEffect(() => {
                if (assets.length > 0 && !selectedAssetId) {
                    setSelectedAssetId(assets[0].id);
                }
            }, [assets, selectedAssetId]);

            const frameworks = {
                iec62443: { name: 'IEC 62443', data: asset?.iec62443 },
                sans: { name: 'SANS Critical Controls', data: asset?.sans },
                ciFortify: { name: 'CIS Fortify', data: asset?.ciFortify },
            };
            const currentFramework = frameworks[selectedFramework];

            const ControlStatusToggle = ({ control, frIndex, controlIndex, isIEC }) => {
                const isGap = control.status === 'Not Implemented' || control.status === 'Partially Implemented';
                
                const handleStatusChange = (e) => {
                    const newStatus = e.target.value;
                    let controlPath;
                    if (isIEC) {
                        controlPath = [frIndex, controlIndex];
                    } else {
                        controlPath = controlIndex;
                    }
                    updateAssetControl(selectedAssetId, selectedFramework, controlPath, newStatus);
                };
                
                const handleCreateTask = () => {
                    const taskDescription = isIEC 
                        ? `Remediate gap in ${asset.name} (IEC ${control.cid}: ${control.requirement})`
                        : `Remediate gap in ${asset.name} (${control.id}: ${control.name})`;
                    
                    addTask(asset.name, taskDescription, 'High'); // Default to high priority for new gaps
                };

                return (
                    <div className="flex items-center space-x-3">
                        <select 
                            value={control.status}
                            onChange={handleStatusChange}
                            disabled={!hasAccess}
                            className={`px-3 py-1 text-sm rounded-lg border focus:ring-indigo-500 focus:border-indigo-500 ${
                                isGap ? 'bg-red-50 border-red-300 text-red-800' : 
                                control.status === 'Implemented' ? 'bg-green-50 border-green-300 text-green-800' : 'bg-gray-50 border-gray-300'
                            }`}
                        >
                            {CONTROL_STATUSES.map(status => <option key={status} value={status}>{status}</option>)}
                        </select>
                        {isGap && hasAccess && (
                            <button onClick={handleCreateTask} className="flex items-center text-xs bg-red-600 text-white px-2 py-1 rounded-full hover:bg-red-700 transition-colors">
                                <Plus className="w-3 h-3 mr-1" /> Task
                            </button>
                        )}
                    </div>
                );
            };

            const IECControlsDisplay = () => (
                <div className="space-y-6">
                    {currentFramework.data.map((fr, frIndex) => (
                        <div key={fr.fr} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-indigo-500">
                            <h3 className="text-xl font-bold text-indigo-700 mb-3">{fr.fr}: {fr.name} (Target SL: {fr.targetSL})</h3>
                            <div className="divide-y divide-gray-100">
                                {fr.controls.map((control, controlIndex) => (
                                    <div key={control.cid} className="flex justify-between items-center py-3">
                                        <div className="w-3/5">
                                            <p className="font-semibold text-gray-800">{control.cid}</p>
                                            <p className="text-sm text-gray-600">{control.requirement}</p>
                                        </div>
                                        <div className="w-2/5 flex justify-end">
                                            <ControlStatusToggle control={control} frIndex={frIndex} controlIndex={controlIndex} isIEC={true} />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );

            const FlatControlsDisplay = () => (
                <div className="bg-white rounded-xl shadow-lg overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Control</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Status</th></tr></thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {currentFramework.data.map((control, controlIndex) => (
                                <tr key={control.id} className="hover:bg-gray-50">
                                    <td className="px-6 py-4 text-sm font-medium text-gray-900">{control.id}</td>
                                    <td className="px-6 py-4 text-sm text-gray-500">{control.description}</td>
                                    <td className="px-6 py-4 text-right">
                                        <ControlStatusToggle control={control} controlIndex={controlIndex} isIEC={false} />
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
            
            if (assets.length === 0) return <div className="p-6 text-gray-500 bg-white rounded-xl shadow-lg">Please add assets in the Asset Builder first.</div>;

            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Security Control Assessment</h1>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 bg-white p-4 rounded-xl shadow-md print-hide">
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Select Asset</label>
                            <select value={selectedAssetId} onChange={(e) => setSelectedAssetId(e.target.value)} className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm">
                                {assets.map(a => <option key={a.id} value={a.id}>{a.name} ({a.zone.split(': ')[0]})</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Select Framework</label>
                            <select value={selectedFramework} onChange={(e) => setSelectedFramework(e.target.value)} className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm">
                                {Object.keys(frameworks).map(key => <option key={key} value={key}>{frameworks[key].name}</option>)}
                            </select>
                        </div>
                    </div>
                    
                    {asset && (
                        <div className="mt-6">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">{currentFramework.name} Controls for: {asset.name}</h2>
                            {selectedFramework === 'iec62443' ? <IECControlsDisplay /> : (currentFramework.data && <FlatControlsDisplay />)}
                        </div>
                    )}
                    {!asset && <div className="p-6 text-gray-500 bg-white rounded-xl shadow-lg">Select an asset to begin assessment.</div>}
                </div>
            );
        };

        // 5.5 Remediation Tasks
        const RemediationTasks = ({ tasks, updateTaskStatus, hasAccess }) => {
            const getPriorityClass = (priority) => {
                switch (priority) {
                    case 'Critical': return 'bg-red-500';
                    case 'High': return 'bg-orange-500';
                    case 'Medium': return 'bg-yellow-500';
                    case 'Low': return 'bg-green-500';
                    default: return 'bg-gray-400';
                }
            };
            
            const getStatusClass = (status) => {
                switch (status) {
                    case 'Open': return 'bg-red-100 text-red-800';
                    case 'In Progress': return 'bg-yellow-100 text-yellow-800';
                    case 'Complete': return 'bg-green-100 text-green-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            const TaskTable = ({ taskList }) => (
                <div className="bg-white rounded-xl shadow-lg overflow-x-auto table-responsive">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset Name</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created By</th>
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {taskList.map(task => (
                                <tr key={task.id} className="hover:bg-indigo-50 transition-colors">
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <span className={`px-2 py-0.5 text-xs font-semibold rounded-full text-white ${getPriorityClass(task.priority)}`}>
                                            {task.priority || 'N/A'}
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 text-sm text-gray-900">{task.description || 'N/A'}</td>
                                    <td className="px-6 py-4 text-sm text-indigo-600 font-medium">{task.assetName || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        {hasAccess ? (
                                            <select 
                                                value={task.status} 
                                                onChange={(e) => updateTaskStatus(task.id, e.target.value)}
                                                className={`px-3 py-1 text-sm rounded-lg border focus:ring-indigo-500 focus:border-indigo-500 ${getStatusClass(task.status)}`}
                                            >
                                                {['Open', 'In Progress', 'Complete'].map(s => <option key={s} value={s}>{s}</option>)}
                                            </select>
                                        ) : (
                                            <span className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(task.status)}`}>
                                                {task.status}
                                            </span>
                                        )}
                                    </td>
                                    <td className="px-6 py-4 text-sm text-gray-500">{MOCK_USERS.find(u => u.uid === task.createdBy)?.role || 'N/A'}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );

            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Remediation Task Management</h1>
                    <TaskTable taskList={tasks} />
                </div>
            );
        };
        
        // 5.6 Reports
        const Reports = () => (
            <div className="space-y-6 bg-white p-6 rounded-xl shadow-lg">
                <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Reporting & Export</h1>
                <p className="text-gray-600">
                    Generate comprehensive reports on compliance, risk scores, and remediation status. For demonstration, you can use the browser's print/PDF feature on the main dashboards.
                </p>
                
                <div className="p-4 border border-indigo-200 rounded-xl space-y-4">
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Report Type</label>
                            <select disabled className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm bg-gray-50">
                                <option>Executive Summary</option>
                                <option>IEC 62443 Compliance Detail</option>
                                <option>Remediation Task Status</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Filter by Zone</label>
                            <select disabled className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm bg-gray-50">
                                <option>All Zones</option>
                                {PURDUE_ZONES.map(z => <option key={z}>{z}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Date Range</label>
                            <input type="text" disabled placeholder="Q4 2025" className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm bg-gray-50" />
                        </div>
                    </div>
                    <button disabled className="flex items-center bg-gray-400 text-white px-4 py-2 rounded-xl font-semibold cursor-not-allowed">
                        <Download className="w-5 h-5 mr-2" /> Generate & Export Report (Disabled)
                    </button>
                </div>
            </div>
        );

        // 5.7 Settings & Admin Dashboard
        const SettingsPage = () => (
            <div className="space-y-6 bg-white p-6 rounded-xl shadow-lg">
                <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Assessment Settings</h1>
                <p className="text-gray-600">Define global targets and assessment parameters here.</p>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div className="p-4 border rounded-xl">
                        <h3 className="font-bold text-indigo-700 mb-2">Target Security Level (SL)</h3>
                        <p className="text-sm text-gray-500 mb-2">The security level to be achieved across the OT network.</p>
                        <select disabled className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm bg-gray-50">
                            <option>SL 1</option>
                            <option>SL 2</option>
                            <option>SL 3 (Recommended)</option>
                            <option>SL 4</option>
                        </select>
                    </div>
                    <div className="p-4 border rounded-xl">
                        <h3 className="font-bold text-indigo-700 mb-2">Assessment Cadence</h3>
                        <p className="text-sm text-gray-500 mb-2">How often should full compliance checks be performed?</p>
                        <select disabled className="mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm bg-gray-50">
                            <option>Quarterly</option>
                            <option>Semi-Annually</option>
                            <option>Annually</option>
                        </select>
                    </div>
                </div>
            </div>
        );

        const AdminDashboard = ({ userId, appId }) => (
            <div className="space-y-6 bg-white p-6 rounded-xl shadow-lg">
                <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">Admin Dashboard & System Info</h1>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-gray-50 p-4 rounded-lg border">
                        <h3 className="font-bold text-lg text-red-700 flex items-center"><Layers className="w-5 h-5 mr-2" /> Application ID (Mandatory Path)</h3>
                        <p className="text-sm text-gray-600 mt-1">This ID is used in the Firestore public path: <code className="font-mono text-xs text-indigo-600 break-all">/artifacts/<strong>{appId}</strong>/public/data/...</code></p>
                        <code className="block mt-2 p-2 bg-white rounded font-mono text-sm break-all">{appId}</code>
                    </div>
                    <div className="bg-gray-50 p-4 rounded-lg border">
                        <h3 className="font-bold text-lg text-indigo-700 flex items-center"><Key className="w-5 h-5 mr-2" /> Current Session User ID</h3>
                        <p className="text-sm text-gray-600 mt-1">The unique UID assigned to this session by Firebase Authentication.</p>
                        <code className="block mt-2 p-2 bg-white rounded font-mono text-sm break-all">{userId}</code>
                    </div>
                </div>

                <h2 className="text-2xl font-semibold text-gray-800 pt-4">Mock User Management</h2>
                <div className="bg-gray-50 rounded-xl overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-100"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email (Mock)</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Full Firestore UID</th></tr></thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {MOCK_USERS.map(user => (
                                <tr key={user.uid} className="hover:bg-gray-50">
                                    <td className="px-6 py-4 whitespace-nowrap"><span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${user.role === 'admin' ? 'bg-indigo-100 text-indigo-800' : 'bg-gray-100 text-gray-800'}`}>{user.role}</span></td>
                                    <td className="px-6 py-4 text-sm text-gray-900">{user.email}</td>
                                    <td className="px-6 py-4 text-sm font-mono text-gray-600 break-all">{user.uid}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const UserGuide = () => (
            <div className="space-y-6 bg-white p-6 rounded-xl shadow-lg">
                <h1 className="text-3xl font-extrabold text-gray-800 border-b pb-2">OT Guardian User Guide / Help</h1>
                <div className="space-y-4 text-gray-700">
                    <p>Welcome to the OT Guardian Security Posture Management simulator. Use the **Role Selector** in the header to switch roles and test access control.</p>
                    
                    <h2 className="text-xl font-semibold text-indigo-700 pt-2 flex items-center"><Cpu className="w-5 h-5 mr-2" /> Asset Builder</h2>
                    <p>Use this view to add new assets (PLCs, HMIs, etc.). When an asset is created, its compliance structures (IEC 62443, SANS) are automatically initialized with all controls set to **'Not Assessed'**.</p>
                    
                    <h2 className="text-xl font-semibold text-indigo-700 pt-2 flex items-center"><CheckCircle className="w-5 h-5 mr-2" /> Security Controls</h2>
                    <p>This is where engineers assess controls. Select an **Asset** and a **Framework** to see the control list. Use the status dropdown to mark compliance. If status is 'Not Implemented' or 'Partially Implemented', a **Create Task** button appears to log a remediation gap.</p>
                    
                    <h2 className="text-xl font-semibold text-indigo-700 pt-2 flex items-center"><Shield className="w-5 h-5 mr-2" /> Risk Dashboards</h2>
                    <p>The dashboards provide a rollup of compliance data. The **Risk Dashboard** focuses on operational metrics and high-risk assets, while the **Manager Dashboard** provides an executive view of Foundational Requirement coverage.</p>
                </div>
            </div>
        );


        // Standard React 18 rendering code
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
